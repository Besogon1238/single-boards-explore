# Старт работы с одноплатниками

В распоряжении лаборатории есть 2 типа одноплатников на основе микропроцессора Allwinner D1 [Sipeed](https://www.sipeed.com/) [Lichee RV](https://wiki.sipeed.com/hardware/en/lichee/RV/RV.html) и [MangoPi](https://mangopi.org) [MQ Pro](https://mangopi.org/mangopi_mqpro).

Первый вопрос, который возникает "Как их запустить?".  Довольно очевидно, что нужен носитель с операционной системой(в нашем случае карта памяти) и образ операционной системы.

<a name="install"></a>

## Установка образа операционной системы на носитель 
![Картридер](/pictures/картридер.jpg)

С образом операционной системы все довольно просто. 

Как я понял, обычно производитель платы предоставляет тестовый образ для демонстрации ее возможностей. В моем же случае из-за моего желания запустить на платах ALT возникла проблема отсутствия такого образа. С этим мне помог Иван Мельников, который собрал [такой образ](https://ftp.altlinux.org/pub/people/iv/images/riscv64/regular-sunxi-riscv64/) для Lichee RV.

Но как записать образ на карточку? На самом деле все довольно просто:

Распакуем архив с образом

```
$ xz -dk /путь/к/архиву
```

Затем, аккуратно вставляем флешку в **картридер**.

Узнаем с помощью lsblk название устройства, и если на нем уже есть точки монтирования, размонтируем.

```
$ lsblk
# umount /dev/sdX* # если что то было примонтировано
```

С помощью утилиты dd запишем образ на флешку:

```
# dd if=путь/к/образу.img of=/dev/sdX bs=4M status=progress
```

После указанных манипуляций мы должны получить карту памяти с готовой операционной системой.

<a name="boot"></a>

## Включение и начало работы с платой 

Поскольку нам необходимо работать с платой, а платы у нас достаточно малоресурсные, чтобы работать на графике(хотя с данным образом Lichee RV ее поддерживает) нам нужно работать через консоль. Для работы с консолью пригодиться **UART-преобразователь**, подключаемый на три контакта  GPIO платы. Контакты TX и RX у Lichee RV подписаны на задней стороне платы, а "гребенка" Mango соответствует спецификации "гребенок" Raspberry PI.

![Джампер](/pictures/джампер%20на%20перехооднике.jpg)

Важно правильно выбрать на UART-преобразователе джампером напряжение. В нашем случае, для обоих одноплатников это 3.3V. 

Если выбрать напряжение ниже необходимого — передача данных просто не будет возможной, а вот если выбрать выше, то появится хорошая возможность спалить устройство. **ГОВОРЮ НА СОБСТВЕННОМ ОПЫТЕ, ВНИМАТЕЛЬНЕЕ!**

Подключаем UART-преобразователь к компьютеру. Для удобства может пригодиться usb-удлинитель, если ПК стационарный. Далее, соединяем пин GND на GPIO контактах с пином GND на преобразователе, а RX пины соединяем с TX пинами, и наоборот.

Теперь понадобится программа для взаимодействия с платой. Например можно воспользоваться tio:

```
# apt-get install tio
```

![UART-преобразователь](/pictures/соелинение%20переходника%20с%20GPIO%20ПЛАТЫ.jpg)

Чтобы определить имя устройства в системе можно почитать логи dmesg. Наприме так:

```
dmesg | grep -i "tty"
```

Подключимся к UART-преобразователю, и ждем поступления сигналов

```
$ tio -b 115200 /dev/ttyUSBX
```

Теперь если вставить флеш-карточку с записанной на нее образом в соответствующий интерфейс на плате, можно увидеть в консоли логи запуска операционной системы, а затем и приглашение ко вводу.

На всех регулярных сборках ALT регулярных сборках, до прохождения мастера первоначальной настройки, логинка *root* с паролем *altlinux*.